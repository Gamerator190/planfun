<div class="eticket-page" *ngIf="ticket">
  <div class="header">
    <button class="back-btn" (click)="goBack()">Â«</button>
    <div class="title">E-Ticket</div>
  </div>

  <div class="ticket-card">
    <div class="top">
      <img
        class="poster"
        [src]="ticket.event.poster || 'assets/placeholder.jpg'"
        [alt]="ticket.event.title"
      />
      <div class="info">
        <div class="event-title">{{ ticket.event.title }}</div>
        <div class="line">Event Date: {{ ticket.event.date }}</div>
        <div class="line">Event Time: {{ ticket.event.time }}</div>
        <div class="line">Purchase Date: {{ ticket.purchaseDate }}</div>
        <div class="line">Seats: {{ ticket.seats.join(', ') }}</div>
        <div class="line subtotal" *ngIf="ticket.appliedPromo">
          Subtotal: Rp {{ formatRupiah(ticket.total + (ticket.discountAmount || 0)) }}
        </div>
        @if (ticket.appliedPromo) {
        <div class="line discount">
          Discount ({{ticket.appliedPromo.discountPercent}}%): - Rp {{
          formatRupiah(ticket.discountAmount || 0) }}
        </div>
        }
        <div class="line final-total">Total: Rp {{ formatRupiah(ticket.total) }}</div>
      </div>
    </div>

    <div class="seat-detail-block" *ngIf="ticket.seatDetails?.length">
      <div class="seat-detail-title">Seat Details</div>

      <div class="seat-detail-row" *ngFor="let s of ticket.seatDetails">
        <span class="sd-seat">{{ s.seat }}</span>
        <span class="sd-type">{{ getTypeLabel(s.typeCode) }}</span>
        <span class="sd-price"> Rp {{ formatRupiah(getTypePrice(s.typeCode)) }} </span>
      </div>
    </div>

    <div class="cut-line">
      <div class="circle left"></div>
      <div class="dashed"></div>
      <div class="circle right"></div>
    </div>

    <div class="bottom">
      <div class="qr-box">
        <div class="qr-inner" #qrcodeCanvas></div>
      </div>
    </div>
    <div class="qr-text">Show this E-Ticket to the event staff for scanning.</div>
  </div>
</div>

<button class="cancel-btn" (click)="cancelBooking()" [disabled]="isCancelDisabled">
  Cancel Booking
</button>

<div class="hint">Screenshot this page to save the E-Ticket in your gallery ðŸ“±</div>
